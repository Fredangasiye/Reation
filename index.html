<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relation | Relational Alignment & Survival Engine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #f8fafc;
            overflow-x: hidden;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }

        .slide-up {
            animation: slideUp 0.5s ease-out forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .quick-fade {
            animation: quickFade 0.2s ease-out forwards;
        }

        @keyframes quickFade {
            from {
                opacity: 0.8;
            }

            to {
                opacity: 1;
            }
        }

        .progress-bar {
            transition: width 0.3s ease-in-out;
        }

        .option-card {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }

        .option-card:hover {
            transform: scale(1.01);
            border-color: rgba(139, 92, 246, 0.3);
        }

        .option-card.selected {
            background-color: rgba(139, 92, 246, 0.2);
            border-color: #8b5cf6;
            transform: scale(0.98);
        }

        .option-card:active {
            transform: scale(0.98);
        }

        .loader {
            border-top-color: #8b5cf6;
            animation: spinner 0.8s linear infinite;
        }

        @keyframes spinner {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .vibrant-gradient {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        }

        .glass {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .blur-content {
            filter: blur(8px);
            pointer-events: none;
            user-select: none;
        }

        .no-scroll {
            overflow: hidden !important;
            height: 100% !important;
        }

        .overlay-container {
            position: absolute;
            inset: 0;
            z-index: 50;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(12px);
            padding: 2rem;
            text-align: center;
        }
    </style>
</head>

<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <!-- App Container -->
    <div id="app"
        class="w-full max-w-2xl mx-auto shadow-2xl rounded-3xl overflow-hidden glass min-h-[600px] flex flex-col uppercase-none">
        <!-- Progress Bar -->
        <div id="progress-container" class="hidden w-full h-1 bg-slate-800">
            <div id="progress-bar" class="h-full vibrant-gradient progress-bar" style="width: 0%"></div>
        </div>

        <!-- Render Target -->
        <div id="view-content" class="flex-grow flex flex-col p-8 md:p-12 relative h-full">
            <!-- Content gets injected here -->
        </div>
    </div>

    <script>
        const RELATIONAL_SIMULATOR_DATA = {
            "performance_tiers": {
                "0-5": "Unstable Reaction Pattern",
                "6-10": "Developing but Inconsistent",
                "11-13": "Strong Relational Presence",
                "14-15": "High-Level Maturity & Control"
            },
            "simulations": [
                {
                    "id": "SIM_M1_DIRECTION",
                    "gender": "male",
                    "title": "Direction & Purpose Training",
                    "scenes": [
                        {
                            "scene": "During dinner she smiles and asks: 'So where do you actually see yourself in five years?' She leans in, clearly assessing long-term stability.",
                            "options": {
                                "A": { "text": "Honestly? I’m still figuring it out.", "score": -2 },
                                "B": { "text": "I’m building toward financial stability and leadership responsibility. I have measurable goals already in motion.", "score": 3 },
                                "C": { "text": "Wherever life takes me, I try not to over-plan.", "score": 1 }
                            }
                        },
                        {
                            "scene": "She asks about your career path. 'Are you happy with where you’re headed?'",
                            "options": {
                                "A": { "text": "I don’t really think that far ahead.", "score": -2 },
                                "B": { "text": "Yes — and if something stops serving my long-term mission, I pivot strategically.", "score": 3 },
                                "C": { "text": "It changes sometimes. I go with the flow.", "score": 1 }
                            }
                        },
                        {
                            "scene": "Conversation shifts toward financial habits. 'Are you more of a saver or spender?'",
                            "options": {
                                "A": { "text": "I don’t track it much.", "score": -2 },
                                "B": { "text": "I budget intentionally. Structure creates freedom later.", "score": 3 },
                                "C": { "text": "I try when I remember.", "score": 1 }
                            }
                        },
                        {
                            "scene": "She says: 'What kind of husband would you want to become one day?'",
                            "options": {
                                "A": { "text": "I haven’t really thought about it seriously.", "score": -2 },
                                "B": { "text": "Protective, steady, and disciplined. Leadership is responsibility.", "score": 3 },
                                "C": { "text": "Probably something in between.", "score": 1 }
                            }
                        },
                        {
                            "scene": "You face a professional setback. She notices you’re quieter than usual.",
                            "options": {
                                "A": { "text": "Withdraw and avoid the topic.", "score": -2 },
                                "B": { "text": "Acknowledge it calmly and explain your adjustment plan.", "score": 3 },
                                "C": { "text": "Complain emotionally about circumstances.", "score": 1 }
                            }
                        }
                    ]
                },
                {
                    "id": "SIM_M2_ASSERTIVENESS",
                    "gender": "male",
                    "title": "Assertiveness & Initiative Training",
                    "scenes": [
                        {
                            "scene": "You’ve just had a strong 20-minute conversation at a bookstore. She’s smiling and clearly engaged. The moment to lead has arrived.",
                            "options": {
                                "A": { "text": "Maybe we’ll run into each other again.", "score": -2 },
                                "B": { "text": "Let’s continue this Tuesday evening. What’s your number?", "score": 3 },
                                "C": { "text": "Keep talking casually without escalating.", "score": 1 }
                            }
                        },
                        {
                            "scene": "She cancels dinner last minute with: 'Something came up. Can we reschedule?'",
                            "options": {
                                "A": { "text": "No worries! Anytime works for me!!", "score": -2 },
                                "B": { "text": "Sure. Let me know which day works best for you.", "score": 3 },
                                "C": { "text": "Ignore her emotionally for two days.", "score": 1 }
                            }
                        },
                        {
                            "scene": "She laughs and says: 'You’re too nice. I don’t know if you’re dangerous enough.'",
                            "options": {
                                "A": { "text": "Haha yeah I guess I’m just nice.", "score": -2 },
                                "B": { "text": "Nice is intentional. Dangerous is controlled.", "score": 3 },
                                "C": { "text": "Change subject nervously.", "score": 1 }
                            }
                        },
                        {
                            "scene": "She strongly disagrees with your opinion during debate.",
                            "options": {
                                "A": { "text": "Immediately agree to avoid tension.", "score": -2 },
                                "B": { "text": "Calmly explain your view without aggression.", "score": 3 },
                                "C": { "text": "Laugh it off and avoid clarity.", "score": 1 }
                            }
                        },
                        {
                            "scene": "After four dates, she asks directly: 'What are you looking for?'",
                            "options": {
                                "A": { "text": "Just seeing where it goes.", "score": -2 },
                                "B": { "text": "I date intentionally. If we align long-term, I pursue seriously.", "score": 3 },
                                "C": { "text": "I’m not ready for that conversation.", "score": 1 }
                            }
                        }
                    ]
                },
                {
                    "id": "SIM_M3_EMOTIONAL_STABILITY",
                    "gender": "male",
                    "title": "Emotional Stability Under Pressure",
                    "scenes": [
                        {
                            "scene": "She takes 6 hours to reply after normally texting quickly.",
                            "options": {
                                "A": { "text": "Double text anxiously.", "score": -2 },
                                "B": { "text": "Stay calm and continue your day.", "score": 3 },
                                "C": { "text": "Send a passive-aggressive joke.", "score": 1 }
                            }
                        },
                        {
                            "scene": "You see her laughing with another attractive man.",
                            "options": {
                                "A": { "text": "Act distant and cold.", "score": -2 },
                                "B": { "text": "Maintain composure and greet confidently.", "score": 3 },
                                "C": { "text": "Interrogate her later.", "score": 1 }
                            }
                        },
                        {
                            "scene": "She says, 'I didn’t like how you handled earlier.'",
                            "options": {
                                "A": { "text": "Shut down emotionally.", "score": -2 },
                                "B": { "text": "Ask for specifics calmly.", "score": 3 },
                                "C": { "text": "Defend yourself aggressively.", "score": 1 }
                            }
                        },
                        {
                            "scene": "She changes plans unexpectedly.",
                            "options": {
                                "A": { "text": "Take it personally.", "score": -2 },
                                "B": { "text": "Adapt without emotional shift.", "score": 3 },
                                "C": { "text": "Express annoyance briefly.", "score": 1 }
                            }
                        },
                        {
                            "scene": "You feel jealous after browsing social media.",
                            "options": {
                                "A": { "text": "Confront immediately.", "score": -2 },
                                "B": { "text": "Regulate internally before discussing calmly.", "score": 3 },
                                "C": { "text": "Withdraw silently.", "score": 1 }
                            }
                        }
                    ]
                },
                {
                    "id": "SIM_M4_LEADERSHIP",
                    "gender": "male",
                    "title": "Leadership & Boundary Training",
                    "scenes": [
                        {
                            "scene": "On the third date she says: 'You choose where we go tonight.' She’s watching how decisive you are.",
                            "options": {
                                "A": { "text": "I don’t mind, whatever you prefer.", "score": -2 },
                                "B": { "text": "I know a great place nearby. Let’s go.", "score": 3 },
                                "C": { "text": "What are you in the mood for?", "score": 1 }
                            }
                        },
                        {
                            "scene": "She makes a slightly disrespectful joke about your ambition in front of friends.",
                            "options": {
                                "A": { "text": "Laugh it off even though it bothers you.", "score": -2 },
                                "B": { "text": "Later calmly tell her you didn’t appreciate that.", "score": 3 },
                                "C": { "text": "Fire back with sarcasm publicly.", "score": 1 }
                            }
                        },
                        {
                            "scene": "She pushes for physical escalation earlier than you're comfortable with.",
                            "options": {
                                "A": { "text": "Go along to keep momentum.", "score": -2 },
                                "B": { "text": "Slow it down confidently without shaming her.", "score": 3 },
                                "C": { "text": "Pull away awkwardly without explanation.", "score": 1 }
                            }
                        },
                        {
                            "scene": "She asks if you're talking to other women.",
                            "options": {
                                "A": { "text": "Lie to avoid tension.", "score": -2 },
                                "B": { "text": "Answer honestly and clarify your standards.", "score": 3 },
                                "C": { "text": "Deflect with humor.", "score": 1 }
                            }
                        },
                        {
                            "scene": "She frequently interrupts you mid-sentence.",
                            "options": {
                                "A": { "text": "Say nothing and accept it.", "score": -2 },
                                "B": { "text": "Calmly say, 'Let me finish this point.'", "score": 3 },
                                "C": { "text": "Interrupt her back later.", "score": 1 }
                            }
                        }
                    ]
                },
                {
                    "id": "SIM_M5_VETTING",
                    "gender": "male",
                    "title": "Vetting & Long-Term Discernment",
                    "scenes": [
                        {
                            "scene": "You feel strong chemistry but discover she mocks long-term commitment.",
                            "options": {
                                "A": { "text": "Ignore it because attraction is high.", "score": -2 },
                                "B": { "text": "Ask deeper questions about her long-term vision.", "score": 3 },
                                "C": { "text": "Hope she changes over time.", "score": 1 }
                            }
                        },
                        {
                            "scene": "She avoids discussing finances entirely.",
                            "options": {
                                "A": { "text": "Avoid the topic forever.", "score": -2 },
                                "B": { "text": "Bring it up respectfully before exclusivity.", "score": 3 },
                                "C": { "text": "Let attraction outweigh structure.", "score": 1 }
                            }
                        },
                        {
                            "scene": "She speaks negatively about past partners repeatedly.",
                            "options": {
                                "A": { "text": "Join in and criticize them too.", "score": -2 },
                                "B": { "text": "Observe pattern and ask growth-oriented questions.", "score": 3 },
                                "C": { "text": "Brush it off as emotional venting.", "score": 1 }
                            }
                        },
                        {
                            "scene": "You discover misalignment in core values.",
                            "options": {
                                "A": { "text": "Compromise your own values.", "score": -2 },
                                "B": { "text": "Reassess compatibility calmly.", "score": 3 },
                                "C": { "text": "Ignore it temporarily.", "score": 1 }
                            }
                        },
                        {
                            "scene": "She pushes for exclusivity quickly.",
                            "options": {
                                "A": { "text": "Agree impulsively.", "score": -2 },
                                "B": { "text": "Suggest continuing intentional evaluation.", "score": 3 },
                                "C": { "text": "Delay indefinitely without clarity.", "score": 1 }
                            }
                        }
                    ]
                },
                {
                    "id": "SIM_F1_SECURITY",
                    "gender": "female",
                    "title": "Self-Worth & Emotional Security",
                    "scenes": [
                        {
                            "scene": "He hasn’t texted for 5 hours during a workday.",
                            "options": {
                                "A": { "text": "Send multiple follow-ups.", "score": -2 },
                                "B": { "text": "Continue your day confidently.", "score": 3 },
                                "C": { "text": "Post indirectly on social media.", "score": 1 }
                            }
                        },
                        {
                            "scene": "He compliments another woman publicly.",
                            "options": {
                                "A": { "text": "Become instantly jealous.", "score": -2 },
                                "B": { "text": "Maintain composure unless boundaries are crossed.", "score": 3 },
                                "C": { "text": "Withdraw emotionally.", "score": 1 }
                            }
                        },
                        {
                            "scene": "He shares a minor criticism about you.",
                            "options": {
                                "A": { "text": "Take it as rejection.", "score": -2 },
                                "B": { "text": "Ask for clarification calmly.", "score": 3 },
                                "C": { "text": "React defensively.", "score": 1 }
                            }
                        },
                        {
                            "scene": "He doesn’t immediately define exclusivity.",
                            "options": {
                                "A": { "text": "Pressure him emotionally.", "score": -2 },
                                "B": { "text": "Clarify expectations directly.", "score": 3 },
                                "C": { "text": "Assume disinterest.", "score": 1 }
                            }
                        },
                        {
                            "scene": "You feel anxious after a great date.",
                            "options": {
                                "A": { "text": "Confess intense feelings early.", "score": -2 },
                                "B": { "text": "Allow momentum to build naturally.", "score": 3 },
                                "C": { "text": "Overanalyze everything.", "score": 1 }
                            }
                        }
                    ]
                },
                {
                    "id": "SIM_F2_RECEPTIVITY",
                    "gender": "female",
                    "title": "Warmth & Receptive Strength",
                    "scenes": [
                        {
                            "scene": "He plans the date confidently.",
                            "options": {
                                "A": { "text": "Criticize his choice instantly.", "score": -2 },
                                "B": { "text": "Appreciate the initiative openly.", "score": 3 },
                                "C": { "text": "Say nothing and remain neutral.", "score": 1 }
                            }
                        },
                        {
                            "scene": "He compliments you sincerely.",
                            "options": {
                                "A": { "text": "Dismiss it awkwardly.", "score": -2 },
                                "B": { "text": "Smile and receive it warmly.", "score": 3 },
                                "C": { "text": "Deflect the compliment.", "score": 1 }
                            }
                        },
                        {
                            "scene": "He shares long-term goals.",
                            "options": {
                                "A": { "text": "Challenge his ability harshly.", "score": -2 },
                                "B": { "text": "Ask thoughtful encouraging questions.", "score": 3 },
                                "C": { "text": "Change topic quickly.", "score": 1 }
                            }
                        },
                        {
                            "scene": "He takes longer to decide something minor.",
                            "options": {
                                "A": { "text": "Take control immediately.", "score": -2 },
                                "B": { "text": "Allow space while observing calmly.", "score": 3 },
                                "C": { "text": "Express subtle frustration.", "score": 1 }
                            }
                        },
                        {
                            "scene": "He sets a respectful boundary.",
                            "options": {
                                "A": { "text": "See it as control.", "score": -2 },
                                "B": { "text": "Respect it and evaluate his consistency.", "score": 3 },
                                "C": { "text": "Test it later.", "score": 1 }
                            }
                        }
                    ]
                },
                {
                    "id": "SIM_F3_EMOTIONAL_REGULATION",
                    "gender": "female",
                    "title": "Emotional Regulation in Dating",
                    "scenes": [
                        {
                            "scene": "He cancels a date due to work stress.",
                            "options": {
                                "A": { "text": "Take it personally.", "score": -2 },
                                "B": { "text": "Respond understandingly and reschedule calmly.", "score": 3 },
                                "C": { "text": "Withdraw affection.", "score": 1 }
                            }
                        },
                        {
                            "scene": "You misinterpret his tone via text.",
                            "options": {
                                "A": { "text": "Confront immediately.", "score": -2 },
                                "B": { "text": "Ask directly for clarity.", "score": 3 },
                                "C": { "text": "Assume negative intent.", "score": 1 }
                            }
                        },
                        {
                            "scene": "He likes another woman's photo.",
                            "options": {
                                "A": { "text": "React emotionally.", "score": -2 },
                                "B": { "text": "Evaluate pattern before reacting.", "score": 3 },
                                "C": { "text": "Make a passive comment.", "score": 1 }
                            }
                        },
                        {
                            "scene": "You feel overwhelmed after a disagreement.",
                            "options": {
                                "A": { "text": "End it abruptly.", "score": -2 },
                                "B": { "text": "Pause and revisit later calmly.", "score": 3 },
                                "C": { "text": "Continue arguing intensely.", "score": 1 }
                            }
                        },
                        {
                            "scene": "He asks for space to think.",
                            "options": {
                                "A": { "text": "Panic and demand explanation.", "score": -2 },
                                "B": { "text": "Respect his space confidently.", "score": 3 },
                                "C": { "text": "Act cold intentionally.", "score": 1 }
                            }
                        }
                    ]
                },
                {
                    "id": "SIM_F4_VETTING",
                    "gender": "female",
                    "title": "Discernment Over Chemistry",
                    "scenes": [
                        {
                            "scene": "He suggests coming over after Date 1.",
                            "options": {
                                "A": { "text": "Go along for chemistry.", "score": -2 },
                                "B": { "text": "Suggest continuing in public settings.", "score": 3 },
                                "C": { "text": "Ghost him without clarity.", "score": 1 }
                            }
                        },
                        {
                            "scene": "He says intense future promises on Date 2.",
                            "options": {
                                "A": { "text": "Mirror the intensity.", "score": -2 },
                                "B": { "text": "Slow the pace deliberately.", "score": 3 },
                                "C": { "text": "Believe immediately.", "score": 1 }
                            }
                        },
                        {
                            "scene": "He avoids discussing values.",
                            "options": {
                                "A": { "text": "Ignore because spark is strong.", "score": -2 },
                                "B": { "text": "Ask direct alignment questions.", "score": 3 },
                                "C": { "text": "Assume alignment.", "score": 1 }
                            }
                        },
                        {
                            "scene": "You spot inconsistency in stories.",
                            "options": {
                                "A": { "text": "Overlook it.", "score": -2 },
                                "B": { "text": "Address calmly.", "score": 3 },
                                "C": { "text": "Investigate obsessively.", "score": 1 }
                            }
                        },
                        {
                            "scene": "He pressures exclusivity quickly.",
                            "options": {
                                "A": { "text": "Agree from excitement.", "score": -2 },
                                "B": { "text": "Suggest continued observation.", "score": 3 },
                                "C": { "text": "Withdraw suddenly.", "score": 1 }
                            }
                        }
                    ]
                },
                {
                    "id": "SIM_F5_LONG_TERM",
                    "gender": "female",
                    "title": "Long-Term Alignment Evaluation",
                    "scenes": [
                        {
                            "scene": "He avoids discussing marriage entirely.",
                            "options": {
                                "A": { "text": "Stay silent indefinitely.", "score": -2 },
                                "B": { "text": "Ask about long-term intentions directly.", "score": 3 },
                                "C": { "text": "Hope it changes later.", "score": 1 }
                            }
                        },
                        {
                            "scene": "He dismisses family as unimportant.",
                            "options": {
                                "A": { "text": "Ignore your discomfort.", "score": -2 },
                                "B": { "text": "Explore compatibility seriously.", "score": 3 },
                                "C": { "text": "Argue emotionally.", "score": 1 }
                            }
                        },
                        {
                            "scene": "Financial discipline differs greatly.",
                            "options": {
                                "A": { "text": "Assume love will fix it.", "score": -2 },
                                "B": { "text": "Discuss long-term financial habits.", "score": 3 },
                                "C": { "text": "Avoid the topic.", "score": 1 }
                            }
                        },
                        {
                            "scene": "You discover differing worldviews.",
                            "options": {
                                "A": { "text": "Compromise your own values.", "score": -2 },
                                "B": { "text": "Assess whether alignment is realistic.", "score": 3 },
                                "C": { "text": "Ignore and focus on attraction.", "score": 1 }
                            }
                        },
                        {
                            "scene": "He says he’s unsure about children long-term.",
                            "options": {
                                "A": { "text": "Suppress your desire.", "score": -2 },
                                "B": { "text": "Clarify expectations before progressing.", "score": 3 },
                                "C": { "text": "Delay discussion indefinitely.", "score": 1 }
                            }
                        }
                    ]
                }
            ]
        };
        const WEBHOOK_URL = "INSERT_YOUR_URL_HERE";

        const DOMAINS = {
            1: "Conflict Escalation Risk (CER)",
            2: "Repair Velocity Gap (RVG)",
            3: "Financial Governance Misalignment (FGM)",
            4: "Authority Structure Tension (AST)",
            5: "Attachment Trigger Instability (ATI)",
            6: "Stress Endurance Simulation"
        };

        const ARCHETYPE_DATA = {
            A: {
                title: "The Challenger (Dominant)",
                shortDesc: "You are a 'Take-Charge' leader. Your data shows that in public disagreements, managing the social calendar, or facing conflict, you naturally assert control.",
                description: "You possess a high-ego/dominant drive, prioritizing leadership, efficiency, and individual sovereignty within the relationship.",
                factors: [
                    "Conflict: You tend to counter-attack and value winning the argument over immediate repair.",
                    "Finance: You view money as a tool for power and autonomy, often seeking CEO-level control.",
                    "Intimacy: You seek validation through achievement and may view connection as a transaction.",
                    "Vision: You have a singular mission and expect your partner to align with your logistical path."
                ],
                advice: "Fred, true leadership requires you to actively pause and invite Cat into the final decision, ensuring she doesn't feel like a passenger in her own life."
            },
            B: {
                title: "The Strategist (Avoidant)",
                shortDesc: "You are highly analytical and value logic. Under stress, your instinct is to detach emotionally to maintain a sense of objective safety.",
                description: "You value logical distance and personal space, often detaching emotionally when the 'temperature' in the room gets too high.",
                factors: [
                    "Conflict: Your default is withdrawal or the silent treatment as a means of self-protection.",
                    "Finance: You maintain strict stewardship but may use financial opacity as a shield for independence.",
                    "Intimacy: You retreat into hobbies or screens when stressed instead of initiating connection.",
                    "Vision: You avoid long-term labels and deep commitments until absolute logical safety is established."
                ],
                advice: "Withdrawal is a slow leak in intimacy. You must practice the 'Safe Return'—even if you need space, give your partner a specific re-engagement time."
            },
            C: {
                title: "The Peacemaker (Secure)",
                shortDesc: "Day-to-day, you are very steady. You prioritize harmony and de-escalate tension through collaborative, attachment-first logic.",
                description: "You have a baseline for emotional security and transparency, viewing your relationship as a unified, collaborative team.",
                factors: [
                    "Conflict: You prioritize pause-and-regulate over reactivity and seek repair within hours.",
                    "Finance: Total transparency is your default, viewing money as a shared resource for a shared team.",
                    "Intimacy: You initiate connection with your partner first when feeling disconnected.",
                    "Vision: You operate with a 'Covenant' mindset—sacrificial love and mutual humility are your core drivers."
                ],
                advice: "Your security is an anchor. However, you must ensure your voice isn't lost in the pursuit of peace. Speak your full truth, not just the harmonious part."
            },
            D: {
                title: "The Nurturer (Passive)",
                shortDesc: "You are adaptive and steady. But under severe stress or major life changes, your instinct is to step back and let a stronger personality take the wheel.",
                description: "You are highly empathetic and adaptive, often suppressesing your own needs to maintain the comfort and schedule of your partner.",
                factors: [
                    "Conflict: You apologize immediately just to stop the fight, even when you aren't at fault.",
                    "Finance: You prefer for your partner to handle all logistics to avoid the stress of decisions.",
                    "Intimacy: You seek validation through being 'needed' and may struggle with boundaries.",
                    "Vision: You mold your life to follow your partner's path, often at the expense of your own voice."
                ],
                advice: "Cat, you must practice voicing your needs before the stress boils over. Your honest dissent is a gift to the relationship's health."
            }
        };

        const PAIRING_DYNAMICS = {
            "AA": { status: "High Risk", dynamic: "The CEO Collision", choices: "Constant power struggles where winning the argument matters more than the person.", social: "Competitive social posturing that can leave third parties feeling the tension." },
            "AB": { status: "Moderate Risk", dynamic: "The Pursuer & The Ghost", choices: "One drives while the other detaches, leading to a decision-making vacuum.", social: "One manages the room while the other seeks an exit or retreats into a screen." },
            "AC": { status: "Optimized", dynamic: "The Anchor & The Visionary", choices: "A strong lead supported by an emotionally secure foundation.", social: "A balanced team where one leads and the other stabilizes the social vibe." },
            "AD": { status: "Moderate Risk", dynamic: "The Driver and The Yielder", choices: "High Friction Potential. Fred likes to drive, and Cat is willing to let him. However, Fred's tendency to take control can cause Cat to experience blocks.", social: "Fred's instinct to assert himself publicly can unintentionally make Cat feel sidelined or unheard." },
            "BA": { status: "Moderate Risk", dynamic: "The Ghost & The Pursuer", choices: "Withdrawal triggers more dominance, creating a cycle of chase and retreat.", social: "Social settings become a battleground for independence vs. control." },
            "BB": { status: "High Risk", dynamic: "The Parallel Lives", choices: "Decision-making is stalled by mutual detachment and fear of vulnerability.", social: "A relationship that looks functional from the outside but feels hollow/isolated on the inside." },
            "BC": { status: "Moderate Risk", dynamic: "The Anchor & The Strategist", choices: "The anchor seeks connection while the strategist seeks logic/space.", social: "A steady social presence with occasional moments of emotional disconnect." },
            "BD": { status: "Moderate Risk", dynamic: "The Detached Lead", choices: "One retreats into logic while the other suppresses needs to maintain peace.", social: "Socially awkward or reserved, lacking a clear 'connector' personality." },
            "CA": { status: "Optimized", dynamic: "The Visionary & The Anchor", choices: "Mutual respect where leadership is invited and stability is cherished.", social: "A socially warm and influential couple that invites others in." },
            "CB": { status: "Moderate Risk", dynamic: "The Strategist & The Anchor", choices: "Balance is maintained but emotional depth requires intentional effort from the strategist.", social: "A calm social presence that can feel slightly distant or private." },
            "CC": { status: "High Alignment", dynamic: "The Covenant Core", choices: "Transparent, sacrificial decision-making that prioritizes the 'Us'.", social: "Naturally hospitable and emotionally safe social leaders." },
            "CD": { status: "Optimized", dynamic: "The Steady Team", choices: "High alignment with low conflict, though both must avoid 'peace at all costs'.", social: "Warm, inviting, and highly relatable social presence." },
            "DA": { status: "Moderate Risk", dynamic: "The Yielder and The Driver", choices: "Fred likes to drive, and Cat is willing to let him, but at the cost of her voice.", social: "Cat feels like a passenger in social settings managed by Fred's initiative." },
            "DB": { status: "Moderate Risk", dynamic: "The Accommodator", choices: "One adapts to the other's logical distance, creating a quiet but lonely dynamic.", social: "A socially passive couple that often follows the lead of friends." },
            "DC": { status: "Optimized", dynamic: "The Steady Team", choices: "Great stability, provided the nurturer feels safe enough to be honest.", social: "Highly consistent and dependable social partners." },
            "DD": { status: "Moderate Risk", dynamic: "The Passive Merge", choices: "Decision-making is slow as neither wants to 'burden' the other.", social: "Extremely kind but can be socially indecisive or invisible." }
        };

        const MALE_TRACK = {
            gender: "male",
            questions: [
                { id: 1, pillar: "M1", reverse: false, text: "I have a clear vision for where my life is headed in the next five years." },
                { id: 2, pillar: "M1", reverse: true, text: "I often feel lost or unsure about my long-term direction." },
                { id: 3, pillar: "M1", reverse: false, text: "I take responsibility for my mistakes without blaming others." },
                { id: 4, pillar: "M1", reverse: true, text: "I rely heavily on external validation to feel confident." },
                { id: 5, pillar: "M1", reverse: false, text: "I pursue meaningful goals consistently." },
                { id: 6, pillar: "M1", reverse: true, text: "I frequently procrastinate on important life decisions." },
                { id: 7, pillar: "M2", reverse: false, text: "I am comfortable initiating conversations with women I’m interested in." },
                { id: 8, pillar: "M2", reverse: true, text: "I hesitate to express romantic interest directly." },
                { id: 9, pillar: "M2", reverse: false, text: "I can confidently ask a woman out without overthinking." },
                { id: 10, pillar: "M2", reverse: true, text: "I avoid taking the lead because I fear rejection." },
                { id: 11, pillar: "M2", reverse: false, text: "I maintain strong eye contact and grounded body language." },
                { id: 12, pillar: "M2", reverse: true, text: "I try to impress women by over-agreeing with them." },
                { id: 13, pillar: "M3", reverse: false, text: "I stay calm during emotional conflict." },
                { id: 14, pillar: "M3", reverse: true, text: "I shut down or withdraw when criticized." },
                { id: 15, pillar: "M3", reverse: false, text: "I rarely act impulsively when emotionally triggered." },
                { id: 16, pillar: "M3", reverse: true, text: "Jealousy or insecurity quickly affects my behavior." },
                { id: 17, pillar: "M3", reverse: false, text: "I regulate my habits (sleep, media, sexual content)." },
                { id: 18, pillar: "M3", reverse: true, text: "I use distractions to avoid dealing with emotions." },
                { id: 19, pillar: "M4", reverse: false, text: "I set clear boundaries when something feels wrong." },
                { id: 20, pillar: "M4", reverse: true, text: "I tolerate disrespect to avoid losing a woman." },
                { id: 21, pillar: "M4", reverse: false, text: "I communicate expectations early in dating." },
                { id: 22, pillar: "M4", reverse: true, text: "I struggle to make decisions in relationships." },
                { id: 23, pillar: "M4", reverse: false, text: "I aim to serve and protect in relationships." },
                { id: 24, pillar: "M4", reverse: true, text: "I become passive once things get serious." },
                { id: 25, pillar: "M5", reverse: false, text: "My finances are stable and responsibly managed." },
                { id: 26, pillar: "M5", reverse: true, text: "I pursue pleasure more than long-term stability." },
                { id: 27, pillar: "M5", reverse: false, text: "I would feel prepared to lead a household." },
                { id: 28, pillar: "M5", reverse: true, text: "I avoid commitment conversations." },
                { id: 29, pillar: "M5", reverse: false, text: "I evaluate a woman’s character before pursuing deeper involvement." },
                { id: 30, pillar: "M5", reverse: true, text: "Physical attraction outweighs deeper compatibility in my choices." }
            ]
        };

        const FEMALE_TRACK = {
            gender: "female",
            questions: [
                { id: 1, pillar: "F1", reverse: false, text: "I feel secure in who I am without needing constant reassurance." },
                { id: 2, pillar: "F1", reverse: true, text: "I compare myself to other women frequently." },
                { id: 3, pillar: "F1", reverse: false, text: "I believe I bring value beyond appearance." },
                { id: 4, pillar: "F1", reverse: true, text: "I fear being alone more than being in the wrong relationship." },
                { id: 5, pillar: "F1", reverse: false, text: "I maintain personal standards consistently." },
                { id: 6, pillar: "F1", reverse: true, text: "I tolerate inconsistent treatment when emotionally attached." },
                { id: 7, pillar: "F2", reverse: false, text: "I express warmth and appreciation openly." },
                { id: 8, pillar: "F2", reverse: true, text: "I test men to see how much they will tolerate." },
                { id: 9, pillar: "F2", reverse: false, text: "I allow a man to take initiative in healthy situations." },
                { id: 10, pillar: "F2", reverse: true, text: "I resist male leadership even when it is constructive." },
                { id: 11, pillar: "F2", reverse: false, text: "I communicate admiration when I respect someone." },
                { id: 12, pillar: "F2", reverse: true, text: "I assume most men will disappoint me." },
                { id: 13, pillar: "F3", reverse: false, text: "I handle emotional conflict calmly." },
                { id: 14, pillar: "F3", reverse: true, text: "I overanalyze messages or changes in tone frequently." },
                { id: 15, pillar: "F3", reverse: false, text: "I take time before reacting emotionally." },
                { id: 16, pillar: "F3", reverse: true, text: "I escalate minor issues into larger conflicts." },
                { id: 17, pillar: "F3", reverse: false, text: "I seek clarity rather than assumptions." },
                { id: 18, pillar: "F3", reverse: true, text: "I fear abandonment strongly." },
                { id: 19, pillar: "F4", reverse: false, text: "I observe a man’s consistency before deep emotional investment." },
                { id: 20, pillar: "F4", reverse: true, text: "I prioritize chemistry over character." },
                { id: 21, pillar: "F4", reverse: false, text: "I value shared beliefs and life direction." },
                { id: 22, pillar: "F4", reverse: true, text: "I stay connected to men who are emotionally unavailable." },
                { id: 23, pillar: "F4", reverse: false, text: "I seek wise input when unsure in dating." },
                { id: 24, pillar: "F4", reverse: true, text: "I hide relationship struggles from trusted mentors." },
                { id: 25, pillar: "F5", reverse: false, text: "I date with long-term potential in mind." },
                { id: 26, pillar: "F5", reverse: true, text: "I rush physical intimacy to secure emotional connection." },
                { id: 27, pillar: "F5", reverse: false, text: "I am patient when timing feels uncertain." },
                { id: 28, pillar: "F5", reverse: true, text: "I ignore red flags because I feel strong attraction." },
                { id: 29, pillar: "F5", reverse: false, text: "I protect my emotional and physical boundaries early." },
                { id: 30, pillar: "F5", reverse: true, text: "I confuse intense feelings with long-term compatibility." }
            ]
        };

        const MALE_ARCHETYPES = {
            "M1": {
                name: "The Drifter",
                trigger: "M1 LOW or WEAK",
                diagnosis: "You lack visible direction and long-term clarity. While you may be intelligent or kind, romantic attraction in serious women often depends on perceived stability and future security. When your life feels unstructured, women struggle to emotionally anchor themselves to you. This doesn’t mean you’re incapable of commitment — it means your life foundation isn’t strong enough yet to inspire confidence.",
                pattern: ["Delayed decisions", "Low urgency in self-development", "Overthinking instead of acting", "Pursuing connection before building your base"],
                signal: "“Good guy… but I don’t feel led.”",
                failure: "When momentum slowed, she subconsciously questioned long-term stability. Emotional energy drops when forward motion disappears.",
                readiness: "LOW–MODERATE. You may desire marriage, but your structure doesn’t yet support it.",
                action: ["Write a detailed 5-year life vision.", "Create a weekly schedule and stick to it strictly.", "Establish a financial budget and track spending.", "Remove one major distraction (gaming, scrolling).", "Commit to physical training 4x per week.", "Stop delaying difficult conversations.", "Reduce passive entertainment by 50%.", "Identify one male mentor.", "Practice decisive communication.", "Do not pursue serious dating until stable."],
                growthPath: "Build mission first. Then pursue partnership. Purpose before romance."
            },
            "M2": {
                name: "The Passive Nice Guy",
                trigger: "M2 LOW + M4 WEAK",
                diagnosis: "You over-prioritize approval. You soften your opinions to avoid rejection. While kindness is valuable, lack of assertive clarity removes polarity and attraction.",
                pattern: ["Over-invest early", "Say what she wants to hear", "Avoid stating standards", "Fear losing her more than losing yourself"],
                signal: "“I feel safe… but not excited.”",
                failure: "You created comfort without direction. She slowly lost romantic energy.",
                readiness: "MODERATE but undeveloped leadership.",
                action: ["Initiate all early-stage plans confidently.", "Stop over-texting — limit fluff.", "Say “no” at least once weekly.", "Express romantic intent clearly.", "Stop apologizing for harmless mistakes.", "Build physical presence.", "Clarify non-negotiable standards.", "Avoid pedestal behavior.", "Practice calm disagreement.", "Date intentionally, not desperately."],
                growthPath: "Develop calm authority. Lead without aggression."
            },
            "M3": {
                name: "The Emotionally Reactive Man",
                trigger: "M3 LOW",
                diagnosis: "Your internal state controls your relationship outcomes.",
                pattern: ["Become distant when hurt", "Act from jealousy", "Escalate emotionally before thinking"],
                signal: "Intensity without groundedness.",
                failure: "Emotional unpredictability erodes trust.",
                readiness: "Varies based on other pillars.",
                action: ["Sleep 7–8 hours consistently.", "Eliminate digital overstimulation.", "Delay reactions by 24 hours.", "Journal during conflict.", "Reduce inflammatory content.", "Exercise consistently.", "Seek emotional mentorship.", "Cut impulsive behaviors.", "Avoid reactive accusations.", "Strengthen personal discipline."],
                growthPath: "Stability before intimacy."
            },
            "M4": {
                name: "The Avoidant Escaper",
                trigger: "M4 LOW + M5 LOW",
                diagnosis: "You retreat when commitment approaches.",
                pattern: ["Ghosting", "Deflection humor", "Avoid “where is this going?” talks"],
                signal: "Charming early, distant later.",
                failure: "Women sense long-term insecurity.",
                readiness: "LOW. Attracting only casual connections.",
                action: ["Initiate serious conversations.", "Clarify dating intentions early.", "Evaluate based on character.", "Stop ghosting.", "Practice vulnerability.", "Commit to small things first.", "Be honest about fears.", "Avoid mixed signals.", "Set clear expectations.", "Follow through on every promise."],
                growthPath: "Depth over avoidance."
            },
            "M5": {
                name: "The Pleasure-Driven Romantic",
                trigger: "M5 LOW + High M2",
                diagnosis: "You prioritize spark over substance. Strong chemistry often overrides deeper screening. Short-term intensity sabotages long-term stability.",
                pattern: ["Prioritize attraction over alignment", "Rush intimacy", "Ignore belief misalignment"],
                signal: "High intensity, low safety.",
                failure: "Short-term passion → long-term instability. Repeating high-drama cycles.",
                readiness: "LOW. High risk of rushing intimacy.",
                action: ["Delay physical progression.", "Evaluate shared beliefs early.", "Pause after emotional highs.", "Remove casual temptations.", "Seek accountability.", "Clarify marriage vision.", "Avoid mismatching depth.", "Observe consistency for 60+ days.", "Reduce stimulating media.", "Reassess character before escalating."],
                growthPath: "Develop long-term discernment."
            },
            "STABLE": {
                name: "The Strong Foundation Builder",
                trigger: "All pillars MODERATE–STRONG",
                diagnosis: "You are stable and serious. Your issue may be selection, not self.",
                pattern: ["Overlooking available partners", "Unrealistic ideals", "Narrow pool"],
                signal: "Reliable, competent, ready.",
                failure: "Waiting indefinitely or choosing based on speed.",
                readiness: "HIGH. Structurally ready.",
                action: ["Increase exposure.", "Clarify non-negotiables.", "Invite wise accountability.", "Be more proactive.", "Expand your social circle.", "Challenge perfectionism.", "Stay consistent.", "Lead with warmth.", "Be patient.", "Value alignment first."],
                growthPath: "Discernment and patience."
            }
        };

        const FEMALE_ARCHETYPES = {
            "F1": {
                name: "The Insecure Seeker",
                trigger: "F1 LOW",
                diagnosis: "You may enter relationships seeking reassurance instead of partnership. Attraction built on need collapses under pressure.",
                pattern: ["Over-attach early", "Fear abandonment", "Tolerate inconsistency"],
                signal: "Intense but fragile.",
                failure: "Selects inconsistent men for validation. Confusing attention with love.",
                readiness: "LOW. Higher risk of unstable outcomes.",
                action: ["Build internal confidence rituals.", "Reduce validation-seeking.", "Strengthen independent joy.", "Limit obsessive text checking.", "Avoid immediate exclusivity.", "Set consistency standards.", "Practice calm communication.", "Delay emotional declarations.", "Avoid inconsistent men.", "Seek accountability."],
                growthPath: "Internal stability before attachment."
            },
            "F2": {
                name: "The Guarded Independent",
                trigger: "F2 LOW + F1 STRONG",
                diagnosis: "You are strong but guarded. Healthy leadership may feel uncomfortable. Attraction weakens when respect and warmth are withheld.",
                pattern: ["Resists masculine leadership", "Hyper self-reliant", "Defensive"],
                signal: "Competent but emotionally closed.",
                failure: "Attracts passive men or pushes strong ones away. Loneliness masked as strength.",
                readiness: "MODERATE. Intentions are positive but habits inconsistent.",
                action: ["Practice appreciation.", "Allow healthy initiative.", "Reduce defensive sarcasm.", "Avoid testing behavior.", "Clarify standards calmly.", "Remove “prove yourself” energy.", "Evaluate character over chemistry.", "Seek wise counsel.", "Slow emotional escalation.", "Practice receptive communication."],
                growthPath: "Balance strength with warmth."
            },
            "F3": {
                name: "The Emotionally Volatile Partner",
                trigger: "F3 LOW",
                diagnosis: "Emotional escalation drives conflict fatigue.",
                pattern: ["Overthinking", "Escalation", "Fear-driven reactions"],
                signal: "Deep but high-maintenance.",
                failure: "Conflict exhaustion. Driving away stable men.",
                readiness: "Varies. High risk of reactive conflict.",
                action: ["Pause 24 hours before confrontation.", "Journal instead of rapid texting.", "Regulate sleep routines.", "Reduce emotional speculation.", "Seek wise feedback before ending.", "Replace assumptions with questions.", "Avoid public airing of struggles.", "Stabilize daily rhythms.", "Practice calm tone modulation.", "Strengthen internal reassurance."],
                growthPath: "Stability before intimacy."
            },
            "F4": {
                name: "The Chemistry Chaser",
                trigger: "F4 LOW + F5 LOW",
                diagnosis: "You follow feelings over alignment. Intensity feels like compatibility.",
                pattern: ["Prioritizes spark over substance", "Falls for unavailable men"],
                signal: "High passion / low safety pattern.",
                failure: "High emotion cycles. Intensity over stability.",
                readiness: "LOW. Risk of rushing intimacy.",
                action: ["Delay physical intimacy.", "Observe consistency before attachment.", "Clarify life direction early.", "Remove inconsistent men quickly.", "Seek trusted accountability.", "Evaluate shared worldview.", "Avoid secrecy in dating.", "Strengthen patience muscle.", "Replace validation with discernment.", "Practice calm dating pacing."],
                growthPath: "Depth over intensity."
            },
            "STABLE": {
                name: "The Stable but Waiting",
                trigger: "All moderate, none low",
                diagnosis: "Solid foundation. May hold unrealistic preference standards.",
                pattern: ["Delaying commitment", "Minor filters", "Narrow pool"],
                signal: "Ready, wise, secure.",
                failure: "Choosing based on speed or minor aesthetic preferences.",
                readiness: "HIGH. Structurally ready.",
                action: ["Reassess must-haves.", "Increase social exposure.", "Consult trusted mentor.", "Stay open-minded.", "Practice warmth.", "Be more approachable.", "Stay consistent.", "Value depth over speed.", "Pace the relationship.", "Lead with wisdom."],
                growthPath: "Slow evaluation and protection of emotional purity."
            }
        };

        const QUESTIONS = [
            // VIBE CHECK (Questions 1-5)
            { id: 1, domain: 0, text: "During a heated argument, what is your most common reaction?", options: { A: "I counterattack.", B: "I give the silent treatment.", C: "I pause to regulate and understand.", D: "I apologize immediately just to stop the fight." } },
            { id: 2, domain: 0, text: "When your partner criticizes you, how do you usually respond?", options: { A: "I bring up their past mistakes.", B: "I walk away without a word.", C: "I try to find the kernel of truth in it.", D: "I accept all the blame to end the tension." } },
            { id: 3, domain: 0, text: "How quickly do you look to 'repair' after a disagreement?", options: { A: "Only after they admit they were wrong.", B: "I prefer to wait days until it blows over.", C: "I try to reach out within hours.", D: "I never let the argument start, I just give in." } },
            { id: 4, domain: 0, text: "What is your stance on the phrase 'Never go to bed angry'?", options: { A: "It's impossible; some things take days to settle.", B: "I prefer to sleep on it alone.", C: "We should at least acknowledge our love before sleeping.", D: "I will stay up all night begging for peace." } },
            { id: 5, domain: 0, text: "Do you ever feel 'contempt' (disgust or superiority) during a fight?", options: { A: "Yes, often when they seem incompetent.", B: "No, I just feel numb and bored.", C: "Rarely; I try to remember their worth.", D: "No, I'm too busy feeling guilty myself." } },

            // AXIS 1: Conflict Escalation Risk (CER) (Questions 6-13)
            { id: 6, domain: 1, text: "When conflict begins, my first instinct is:", options: { A: "Stay calm and discuss", B: "Clarify my point firmly", C: "Defend myself", D: "Raise intensity", E: "Shut down or withdraw" } },
            { id: 7, domain: 1, text: "If I feel disrespected, I:", options: { A: "Address it calmly", B: "Bring it up later", C: "Become sarcastic", D: "Confront aggressively", E: "Emotionally detach" } },
            { id: 8, domain: 1, text: "When tension rises, I:", options: { A: "Slow the conversation", B: "Try to reason logically", C: "Repeat my point", D: "Escalate to be heard", E: "Exit the conversation" } },
            { id: 9, domain: 1, text: "I believe arguments should:", options: { A: "End in resolution", B: "Be paused if heated", C: "Be won if necessary", D: "Establish dominance", E: "Be avoided entirely" } },
            { id: 10, domain: 1, text: "When my partner criticizes me, I:", options: { A: "Reflect and respond", B: "Clarify misunderstanding", C: "Justify myself", D: "Counter-attack", E: "Withdraw emotionally" } },
            { id: 11, domain: 1, text: "I am comfortable apologizing:", options: { A: "Immediately", B: "After reflection", C: "If both share blame", D: "Rarely", E: "Almost never" } },
            { id: 12, domain: 1, text: "During disagreement, my tone tends to:", options: { A: "Calm", B: "Firm", C: "Defensive", D: "Intense", E: "Cold" } },
            { id: 13, domain: 1, text: "After conflict, I:", options: { A: "Reconnect quickly", B: "Need brief space", C: "Stay distant for hours", D: "Replay it internally", E: "Shut down for days" } },

            // AXIS 2: Repair Velocity Gap (RVG) (Questions 14-21)
            { id: 14, domain: 2, text: "After tension, I prefer:", options: { A: "Immediate repair", B: "Short pause then repair", C: "Time alone first", D: "Avoiding discussion", E: "Pretending nothing happened" } },
            { id: 15, domain: 2, text: "Physical reassurance after conflict feels:", options: { A: "Necessary", B: "Helpful", C: "Neutral", D: "Uncomfortable", E: "Unwanted" } },
            { id: 16, domain: 2, text: "If conflict lingers, I:", options: { A: "Initiate resolution", B: "Wait briefly", C: "Assume partner should fix it", D: "Grow resentful", E: "Stop caring" } },
            { id: 17, domain: 2, text: "I define repair as:", options: { A: "Emotional clarity", B: "Verbal apology", C: "Behavioral change", D: "Silence restored", E: "Tension avoidance" } },
            { id: 18, domain: 2, text: "If I caused hurt, I:", options: { A: "Acknowledge clearly", B: "Explain context", C: "Minimize impact", D: "Deflect blame", E: "Ignore it" } },
            { id: 19, domain: 2, text: "When I’m hurt, I:", options: { A: "Say it directly", B: "Hint indirectly", C: "Expect them to know", D: "Become distant", E: "Withhold affection" } },
            { id: 20, domain: 2, text: "I believe unresolved conflict:", options: { A: "Damages intimacy", B: "Eventually fades", C: "Is normal", D: "Strengthens dominance", E: "Doesn’t matter" } },
            { id: 21, domain: 2, text: "Emotional distance after conflict makes me:", options: { A: "Uncomfortable quickly", B: "Slightly uneasy", C: "Neutral", D: "Relieved", E: "Safer" } },

            // AXIS 3: Financial Governance Misalignment (FGM) (Questions 22-29)
            { id: 22, domain: 3, text: "Financial decisions should be:", options: { A: "Joint and transparent", B: "Domain-based", C: "Led by higher earner", D: "Individual accounts separate", E: "Independent and private" } },
            { id: 23, domain: 3, text: "Major purchases require:", options: { A: "Mutual agreement", B: "Consultation", C: "Notification only", D: "Individual discretion", E: "No discussion required" } },
            { id: 24, domain: 3, text: "Debt is:", options: { A: "High caution", B: "Acceptable short-term", C: "Normal tool", D: "Necessary growth tool", E: "Not concerning" } },
            { id: 25, domain: 3, text: "Provision responsibility:", options: { A: "Shared equally", B: "Role-defined", C: "Primary earner leads", D: "Individual responsibility", E: "Undefined" } },
            { id: 26, domain: 3, text: "Financial secrecy is:", options: { A: "Unacceptable", B: "Rarely justified", C: "Situational", D: "Understandable", E: "Acceptable" } },
            { id: 27, domain: 3, text: "Giving/charity should be:", options: { A: "Structured and agreed", B: "Encouraged individually", C: "Flexible", D: "Optional", E: "Personal only" } },
            { id: 28, domain: 3, text: "Savings priority:", options: { A: "Mandatory", B: "Stronged encouraged", C: "If possible", D: "Minimal", E: "Not important" } },
            { id: 29, domain: 3, text: "If partner overspends:", options: { A: "Calm discussion", B: "Concern raised", C: "Frustration expressed", D: "Anger", E: "Withdrawal" } },

            // AXIS 4: Authority Structure Tension (AST) (Questions 30-37)
            { id: 30, domain: 4, text: "In marriage, leadership should be:", options: { A: "Mutual influence", B: "Domain-based", C: "One primary leader", D: "Situational power shifts", E: "Individual autonomy" } },
            { id: 31, domain: 4, text: "Final decision in stalemate:", options: { A: "Delayed until aligned", B: "Compromise", C: "Majority logic", D: "Stronger personality", E: "Whoever cares more" } },
            { id: 32, domain: 4, text: "Respect means:", options: { A: "Mutual honor", B: "Listening seriously", C: "Not challenging publicly", D: "Obedience", E: "Avoiding disagreement" } },
            { id: 33, domain: 4, text: "Submission means:", options: { A: "Voluntary cooperation", B: "Trusting leadership", C: "Role-based yielding", D: "Compliance", E: "Not applicable" } },
            { id: 34, domain: 4, text: "If I disagree strongly:", options: { A: "Seek understanding", B: "State position calmly", C: "Push until accepted", D: "Override if needed", E: "Withdraw" } },
            { id: 35, domain: 4, text: "I feel secure when:", options: { A: "Influence is mutual", B: "Structure is clear", C: "Authority is defined", D: "I retain autonomy", E: "I control decisions" } },
            { id: 36, domain: 4, text: "If partner leads poorly:", options: { A: "Discuss respectfully", B: "Suggest adjustment", C: "Take control", D: "Undermine privately", E: "Disengage" } },
            { id: 37, domain: 4, text: "Power imbalance makes me:", options: { A: "Curious", B: "Alert", C: "Defensive", D: "Angry", E: "Withdrawn" } },

            // AXIS 5: Attachment Trigger Instability (ATI) (Questions 38-45)
            { id: 38, domain: 5, text: "When I feel ignored:", options: { A: "Ask directly", B: "Seek reassurance", C: "Become distant", D: "Escalate", E: "Shut down" } },
            { id: 39, domain: 5, text: "When partner needs space:", options: { A: "Respect it calmly", B: "Ask timeframe", C: "Feel uneasy", D: "Take it personally", E: "Assume rejection" } },
            { id: 40, domain: 5, text: "Emotional closeness requires:", options: { A: "Consistency", B: "Verbal affirmation", C: "Physical affection", D: "Frequent contact", E: "Constant reassurance" } },
            { id: 41, domain: 5, text: "I fear:", options: { A: "Betrayal", B: "Emotional neglect", C: "Loss of control", D: "Being replaced", E: "Abandonment" } },
            { id: 42, domain: 5, text: "When stressed, I need:", options: { A: "Encouragement", B: "Problem-solving", C: "Silence", D: "Physical presence", E: "Withdrawal" } },
            { id: 43, domain: 5, text: "If partner pulls away:", options: { A: "Check in gently", B: "Wait briefly", C: "Press for answers", D: "Accuse distance", E: "Retreat emotionally" } },
            { id: 44, domain: 5, text: "Jealousy feels:", options: { A: "Rare", B: "Occasional", C: "Manageable", D: "Intense", E: "Overwhelming" } },
            { id: 45, domain: 5, text: "I feel most secure when:", options: { A: "Stability is consistent", B: "Communication is frequent", C: "Roles are clear", D: "Attention is high", E: "I control closeness" } },

            // AXIS 6: Stress Endurance Simulation
            { id: 46, domain: 6, text: "If we lost income:", options: { A: "Strategize calmly", B: "Tighten spending", C: "Stress heavily", D: "Blame", E: "Withdraw" } },
            { id: 47, domain: 6, text: "If extended family interferes:", options: { A: "Protect unity", B: "Mediate carefully", C: "Avoid confrontation", D: "Side with family", E: "Disengage" } },
            { id: 48, domain: 6, text: "If partner struggles spiritually:", options: { A: "Support patiently", B: "Encourage gently", C: "Worry privately", D: "Pressure change", E: "Distance emotionally" } },
            { id: 49, domain: 6, text: "Chronic illness would:", options: { A: "Deepen commitment", B: "Challenge but endure", C: "Cause fear", D: "Overwhelm", E: "Create resentment" } },
            { id: 50, domain: 6, text: "Under long stress I:", options: { A: "Stay steady", B: "Become anxious", C: "Become critical", D: "Become distant", E: "Shut down" } }
        ];

        // --- STATE ---
        let state = {
            view: 'landing',
            mode: 'standard', // 'standard' or 'single'
            name: '',
            relationshipStatus: null,
            currentQuestion: 0,
            answers: [],
            p1Name: '',
            p1Data: null,
            isPartner2: false,
            syncing: false,
            // Single Module State
            singleStep: 1,
            gender: null,
            singleAnswers: [], // will store {id, score, pillar}
            // Simulator State
            currentSim: null,
            currentSimScene: 0,
            simScore: 0,
            simResults: null
        };

        const setView = (view) => { state.view = view; render(); };

        function startSingleFlow() {
            state.name = document.getElementById('user-name').value || "User";
            state.mode = 'single';
            state.singleStep = 1;
            setView('single-flow');
        }

        function handleSingleLogic(choice) {
            if (state.singleStep === 1) {
                if (choice === 'Yes') {
                    state.singleStep = 2;
                    render();
                } else {
                    // Exit Module
                    location.reload();
                }
            } else if (state.singleStep === 2) {
                state.gender = choice.toLowerCase();
                state.singleStep = 'quiz';
                state.currentQuestion = 0;
                state.singleAnswers = [];
                render();
            }
        }

        function render() {
            const content = document.getElementById('view-content');
            const progressContainer = document.getElementById('progress-container');
            content.innerHTML = '';

            if (state.view === 'landing') {
                progressContainer.classList.add('hidden');
                content.innerHTML = `
                    <div class="fade-in space-y-8 text-center my-auto">
                        <div class="space-y-4">
                            <h1 class="text-5xl font-bold tracking-tight text-white">Relation</h1>
                            <p class="text-xl text-slate-400 font-light max-w-md mx-auto">"Identify hidden friction points and align your relationship architecture."</p>
                        </div>
                        <div class="max-w-sm mx-auto space-y-6">
                            <input id="user-name" type="text" placeholder="Enter your name" class="w-full bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-4 text-center text-lg outline-none focus:ring-2 focus:ring-violet-500 transition-all">
                            <div class="space-y-4 flex flex-col items-center">
                                <button onclick="startSingleFlow()" class="w-full bg-emerald-600 py-4 rounded-xl font-bold text-lg hover:bg-emerald-500 transition-all shadow-lg shadow-emerald-500/20 px-4">SINGLE: AM I READY?</button>
                                <button onclick="startApp('Coupled')" class="w-full bg-indigo-600 py-4 rounded-xl font-bold text-lg hover:bg-indigo-500 transition-all shadow-lg shadow-indigo-500/20">In a Relationship: Strengthening us</button>
                            </div>
                        </div>
                        <p class="text-sm text-slate-500 italic">"Start your project with a 5-Question Vibe Check."</p>
                    </div>
                `;
            } else if (state.view === 'quiz') {
                progressContainer.classList.remove('hidden');
                const q = QUESTIONS[state.currentQuestion];
                const progress = ((state.currentQuestion) / QUESTIONS.length) * 100;
                document.getElementById('progress-bar').style.width = `${progress}%`;

                content.innerHTML = `
                    <div class="quick-fade space-y-8">
                        <div class="space-y-2">
                            <span class="text-xs font-bold uppercase tracking-widest text-violet-400">${DOMAINS[q.domain]}</span>
                            <h2 class="text-2xl font-medium leading-snug">${q.text}</h2>
                        </div>
                        <div class="grid grid-cols-1 gap-4">
                            ${Object.entries(q.options).map(([key, text]) => `
                                <div onclick="selectOption(this, '${key}')" class="option-card p-5 rounded-2xl glass border-slate-800 hover:border-violet-500/50 flex items-center space-x-4">
                                    <span class="w-8 h-8 rounded-full flex items-center justify-center bg-slate-800 text-slate-400 font-bold text-sm">${key}</span>
                                    <span class="text-lg text-slate-200">${text}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            } else if (state.view === 'teaser') {
                progressContainer.classList.remove('hidden');
                const teaser = getTeaserInsight();
                content.innerHTML = `
                    <div class="fade-in space-y-8 text-center my-auto">
                        <div class="flex flex-col items-center space-y-4">
                            <div class="loader w-12 h-12 border-4 border-slate-800 rounded-full mb-4"></div>
                            <h3 class="text-xl font-bold">Analyzing Behavioral Baseline...</h3>
                        </div>
                        <div class="space-y-6 text-left">
                            <div class="p-6 rounded-2xl bg-slate-800/50 border border-slate-700 space-y-2">
                                <p class="text-violet-400 font-bold uppercase text-xs tracking-widest">1. Your Baseline Tendency</p>
                                <p class="text-lg text-slate-200">${teaser.baseline}</p>
                            </div>
                            <div class="p-6 rounded-2xl bg-slate-800/50 border border-slate-700 space-y-2">
                                <p class="text-violet-400 font-bold uppercase text-xs tracking-widest">2. The Hidden Risk</p>
                                <p class="text-lg text-slate-300 italic">"${teaser.risk}"</p>
                            </div>
                            <div class="p-6 rounded-2xl bg-violet-600/10 border border-violet-600/20 space-y-3">
                                <p class="text-violet-500 font-bold uppercase text-xs tracking-widest">3. The Cliffhanger</p>
                                <p class="text-sm text-slate-300 leading-relaxed">"Your surface baseline is clear, but we haven't mapped your relational architecture. Most relationships collapse because they ignore the 'MRI' level—attachment triggers, financial transparency, and conflict repair speed. You are 10% away from your full Blueprint."</p>
                            </div>
                        </div>
                        <button onclick="setView('quiz')" class="w-full py-4 bg-violet-600 rounded-xl font-bold animate-pulse shadow-lg shadow-violet-500/40">Continue for a full assessment (FREE)</button>
                    </div>
                `;
            } else if (state.view === 'single-flow') {
                progressContainer.classList.add('hidden');
                if (state.singleStep === 1) {
                    content.innerHTML = `
                        <div class="fade-in space-y-8 text-center my-auto">
                            <div class="space-y-4">
                                <span class="text-emerald-500 font-black uppercase text-xs tracking-widest">Screen 1</span>
                                <h2 class="text-3xl font-bold">Are you currently single and looking for a serious relationship?</h2>
                            </div>
                            <div class="grid grid-cols-1 gap-4 max-w-sm mx-auto">
                                <button onclick="handleSingleLogic('Yes')" class="w-full bg-emerald-600 py-4 rounded-xl font-bold text-lg hover:bg-emerald-500 transition-all">Yes</button>
                                <button onclick="handleSingleLogic('No')" class="w-full glass py-4 rounded-xl font-bold text-lg hover:bg-slate-800 transition-all">No (Exit Module)</button>
                            </div>
                        </div>
                    `;
                } else if (state.singleStep === 2) {
                    content.innerHTML = `
                        <div class="fade-in space-y-8 text-center my-auto">
                            <div class="space-y-4">
                                <span class="text-emerald-500 font-black uppercase text-xs tracking-widest">Screen 2</span>
                                <h2 class="text-3xl font-bold">Select Your Gender</h2>
                            </div>
                            <div class="grid grid-cols-1 gap-4 max-w-sm mx-auto">
                                <button onclick="handleSingleLogic('Male')" class="w-full bg-blue-600 py-4 rounded-xl font-bold text-lg hover:bg-blue-500 transition-all">Male</button>
                                <button onclick="handleSingleLogic('Female')" class="w-full bg-pink-600 py-4 rounded-xl font-bold text-lg hover:bg-pink-500 transition-all">Female</button>
                            </div>
                        </div>
                    `;
                } else if (state.singleStep === 'quiz') {
                    progressContainer.classList.remove('hidden');
                    const track = state.gender === 'male' ? MALE_TRACK : FEMALE_TRACK;
                    const q = track.questions[state.currentQuestion];
                    const progress = (state.currentQuestion / track.questions.length) * 100;
                    document.getElementById('progress-bar').style.width = `${progress}%`;

                    content.innerHTML = `
                        <div class="quick-fade space-y-8">
                            <div class="space-y-2">
                                <span class="text-xs font-bold uppercase tracking-widest text-emerald-400">Pillar: ${q.pillar}</span>
                                <h2 class="text-2xl font-medium leading-snug">${q.text}</h2>
                            </div>
                            <div class="grid grid-cols-1 gap-3">
                                <button onclick="selectSingleOption(5)" class="option-card p-4 rounded-xl glass border-slate-800 hover:border-emerald-500/50 text-left flex items-center justify-between">
                                    <span>Strongly Agree</span>
                                </button>
                                <button onclick="selectSingleOption(4)" class="option-card p-4 rounded-xl glass border-slate-800 hover:border-emerald-500/50 text-left flex items-center justify-between">
                                    <span>Agree</span>
                                </button>
                                <button onclick="selectSingleOption(3)" class="option-card p-4 rounded-xl glass border-slate-800 hover:border-emerald-500/50 text-left flex items-center justify-between">
                                    <span>Neutral</span>
                                </button>
                                <button onclick="selectSingleOption(2)" class="option-card p-4 rounded-xl glass border-slate-800 hover:border-emerald-500/50 text-left flex items-center justify-between">
                                    <span>Disagree</span>
                                </button>
                                <button onclick="selectSingleOption(1)" class="option-card p-4 rounded-xl glass border-slate-800 hover:border-emerald-500/50 text-left flex items-center justify-between">
                                    <span>Strongly Disagree</span>
                                </button>
                            </div>
                        </div>
                    `;
                }
            } else if (state.view === 'simulator') {
                progressContainer.classList.add('hidden');
                if (state.simResults) {
                    content.innerHTML = `
                        <div class="fade-in space-y-10 text-center my-auto">
                            <div class="space-y-4">
                                <span class="text-violet-400 font-black uppercase text-xs tracking-widest">Training Complete</span>
                                <h2 class="text-4xl font-black text-white">${state.currentSim.title}</h2>
                            </div>
                            <div class="bg-violet-600/10 border border-violet-600/20 p-8 rounded-3xl space-y-4">
                                <p class="text-slate-400 text-sm font-bold uppercase tracking-widest">Performance Tier</p>
                                <p class="text-2xl font-black text-white">${state.simResults.tier}</p>
                                <div class="pt-4">
                                    <div class="w-full h-2 bg-slate-800 rounded-full overflow-hidden">
                                        <div class="h-full bg-violet-500" style="width: ${Math.max(0, (state.simResults.score / 15) * 100)}%"></div>
                                    </div>
                                    <p class="text-[10px] text-slate-500 mt-2">Score: ${state.simResults.score}/15</p>
                                </div>
                            </div>
                            <button onclick="setView('results')" class="w-full py-5 glass border-slate-700 rounded-2xl font-black uppercase tracking-widest text-xs hover:bg-slate-800 transition-all">Back to Report</button>
                        </div>
                    `;
                } else {
                    const scene = state.currentSim.scenes[state.currentSimScene];
                    content.innerHTML = `
                        <div class="quick-fade space-y-8">
                            <div class="space-y-4">
                                <div class="flex justify-between items-center">
                                    <span class="text-xs font-black uppercase tracking-widest text-violet-400">${state.currentSim.title}</span>
                                    <span class="text-[10px] font-bold text-slate-500">Scene ${state.currentSimScene + 1}/5</span>
                                </div>
                                <h2 class="text-21 font-medium leading-relaxed text-slate-200">${scene.scene}</h2>
                            </div>
                            <div class="grid grid-cols-1 gap-4">
                                ${Object.entries(scene.options).map(([key, opt]) => `
                                    <button onclick="selectSimOption('${key}')" class="option-card p-6 rounded-2xl glass border-slate-800 hover:border-violet-500/50 text-left transition-all">
                                        <p class="text-slate-200 font-medium">${opt.text}</p>
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
            } else if (state.view === 'results') {
                progressContainer.classList.add('hidden');
                const scores = calculateScores();

                content.innerHTML = `
                    <div class="fade-in space-y-12 pb-12">
                        <div class="text-center space-y-2">
                            <h1 class="text-sm font-black uppercase tracking-[0.3em] text-violet-500">${state.mode === 'single' ? 'WHO YOU ARE IN DATING' : 'RELATIONSHIP STABILITY SCAN'}</h1>
                            <h2 class="text-4xl font-black text-white leading-tight">${state.mode === 'single' ? 'YOUR REPORT' : 'RELATION BLUEPRINT'}</h2>
                            <p class="text-slate-400 font-medium">Breakdown for <span class="text-white font-bold">${state.name || "User"}</span>.</p>
                        </div>

                        ${state.mode === 'single' ? renderSingleResults() : renderAlignmentForecast()}

                        <div class="pt-12 border-t border-slate-800/50 space-y-8">
                            <div class="text-center space-y-4">
                                <div id="sync-status" class="bg-blue-500/10 border border-blue-500/20 py-3 px-6 rounded-full inline-flex items-center space-x-3">
                                    <span class="w-2.5 h-2.5 rounded-full bg-blue-500 animate-pulse shadow-[0_0_10px_rgba(59,130,246,0.5)]"></span>
                                    <span id="sync-text" class="text-[10px] text-blue-400 font-black uppercase tracking-[0.1em]">Relational Data Encrypted & Synced</span>
                                </div>
                                <p class="text-slate-500 text-sm font-medium italic">"The habits you build now shape your future. Save your relationship guide below."</p>
                            </div>
                            
                            <div class="max-w-md mx-auto space-y-3">
                                <input type="email" id="email-capture" placeholder="Enter your email" class="w-full bg-slate-800 border border-slate-700/50 rounded-2xl px-6 py-5 focus:ring-2 focus:ring-violet-500 outline-none text-center font-medium shadow-inner transition-all">
                                <button id="send-report-btn" onclick="syncToWebhook(true)" class="w-full py-5 bg-violet-600 hover:bg-violet-500 text-white rounded-2xl font-black uppercase tracking-widest text-xs transition-all shadow-xl shadow-indigo-900/20">Send Report to Engine</button>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        function startApp(status) {
            state.name = document.getElementById('user-name').value || (state.isPartner2 ? "Partner 2" : "Partner 1");
            state.relationshipStatus = status;
            setView('quiz');
        }

        function startSimulator(pillarId) {
            const genderSims = RELATIONAL_SIMULATOR_DATA.simulations.filter(s => s.gender === state.gender);
            const pillarMap = {
                M1: "DIRECTION", M2: "ASSERTIVENESS", M3: "EMOTIONAL_STABILITY", M4: "LEADERSHIP", M5: "VETTING",
                F1: "SECURITY", F2: "RECEPTIVITY", F3: "EMOTIONAL_REGULATION", F4: "VETTING", F5: "LONG_TERM"
            };
            const targetSimIdPart = pillarMap[pillarId];
            let sim = genderSims.find(s => s.id.includes(targetSimIdPart));
            if (!sim) sim = genderSims[0];

            state.currentSim = sim;
            state.currentSimScene = 0;
            state.simScore = 0;
            state.simResults = null;
            setView('simulator');
        }

        function selectSimOption(optionKey) {
            const scene = state.currentSim.scenes[state.currentSimScene];
            const option = scene.options[optionKey];
            state.simScore += option.score;

            state.currentSimScene++;
            if (state.currentSimScene >= state.currentSim.scenes.length) {
                const score = state.simScore;
                let tier = "";
                if (score <= 5) tier = RELATIONAL_SIMULATOR_DATA.performance_tiers["0-5"];
                else if (score <= 10) tier = RELATIONAL_SIMULATOR_DATA.performance_tiers["6-10"];
                else if (score <= 13) tier = RELATIONAL_SIMULATOR_DATA.performance_tiers["11-13"];
                else tier = RELATIONAL_SIMULATOR_DATA.performance_tiers["14-15"];

                state.simResults = { score, tier };
            }
            render();
        }

        function selectOption(el, option) {
            // Add selected class to the clicked element
            if (el) el.classList.add('selected');

            // Slight delay for visual feedback before transition
            setTimeout(() => {
                state.answers.push(option);
                state.currentQuestion++;
                if (state.currentQuestion === 5) setView('teaser');
                else if (state.currentQuestion >= QUESTIONS.length) { syncToWebhook(false); setView('results'); }
                else render();
            }, 100);
        }

        function selectSingleOption(userAnswer) {
            const track = state.gender === 'male' ? MALE_TRACK : FEMALE_TRACK;
            const q = track.questions[state.currentQuestion];

            // Scoring Logic: If reverse:true → score = 6 - userAnswer, Else → score = userAnswer
            const score = q.reverse ? (6 - userAnswer) : userAnswer;
            state.singleAnswers.push({ id: q.id, pillar: q.pillar, score: score });

            state.currentQuestion++;
            if (state.currentQuestion >= track.questions.length) {
                syncToWebhook(false);
                setView('results');
            } else {
                render();
            }
        }


        function getTeaserInsight() {
            const counts = { A: 0, B: 0, C: 0, D: 0 };
            state.answers.forEach(a => counts[a]++);
            if (counts.A >= 2) return { baseline: "The Challenger: You have a natural leadership drive and prioritize efficiency.", risk: "Leadership can blur into dominance. If you don't build a 'veto culture', your partner may learn to appease rather than align." };
            if (counts.B >= 2) return { baseline: "The Strategist: You value autonomy and seek logical distance before emotional commitments.", risk: "Independence is your armor, but it can starve the relationship of 'proximate safety.' Withdrawal is a slow leak in intimacy." };
            if (counts.C >= 2) return { baseline: "The Peacemaker: You prioritize harmony and de-escalate tension through collaborative logic.", risk: "Yielding to avoid conflict often leads to silent resentment and internalizing tension, which is a form of courtship deception." };
            if (counts.D >= 2) return { baseline: "The Nurturer: You are highly empathetic and prioritize the emotional comfort of others over your own needs.", risk: "Passive adaptation creates a 'one-way map' where your partner never actually meets the real you." };
            return { baseline: "The Observer: You are analytical, cautious, and favor observation over immediate reaction.", risk: "Delayed intensity can miss the window for repair, leaving your partner feeling isolated." };
        }

        const SCORING_MAP = { A: 1, B: 2, C: 3, D: 4, E: 5 };

        const SCAN_CONTENT = {
            1: {
                title: "Section 1: Conflict Heat Index",
                desc: "How intense your arguments become and how hard they are to calm down.",
                brackets: {
                    stable: { range: [0, 3], status: "STABLE", pattern: "Disagreements stay controlled. You usually avoid personal attacks.", risk: "Low conflict does not always mean full resolution. Issues can stay under the surface.", growth: "End every disagreement with a clear verbal reset within 12 hours.", prompt: "When we argue, what helps you feel understood fastest?", habit: "Slow your tone intentionally during conflict.", principle: "Controlled speech preserves strength." },
                    growth: { range: [4, 6], status: "GROWTH ZONE", pattern: "Conflict sometimes gets heated but is usually manageable.", risk: "Repeated moderate escalation builds tension over time.", growth: "Use a 20-minute break rule before continuing heated arguments.", prompt: "What usually triggers me during conflict?", habit: "Replace blame statements with feeling statements.", principle: "Patience reduces damage." },
                    watch: { range: [7, 8], status: "WATCH ZONE", pattern: "Arguments escalate quickly and may become personal.", risk: "Frequent intensity reduces emotional safety.", growth: "Commit to zero name-calling or sarcasm for 30 days.", prompt: "What part of our arguments feels unsafe?", habit: "Pause 10 seconds before responding when triggered.", principle: "Self-control protects unity." },
                    risk: { range: [9, 10], status: "HIGH RISK", pattern: "Conflict often becomes destructive or unresolved.", risk: "Repeated hostility weakens respect and attachment.", growth: "Schedule weekly structured conflict review sessions.", prompt: "What would safe disagreement look like for us?", habit: "Stop discussion immediately if voices rise.", principle: "Strength is measured in restraint." }
                }
            },
            2: {
                title: "Section 2: Repair Speed Index",
                desc: "How quickly you reconnect after arguments.",
                brackets: {
                    stable: { range: [0, 3], status: "ALIGNED", pattern: "You reconnect easily after conflict.", risk: "Under stress, repair speed can still slow down.", growth: "Always confirm closure verbally.", prompt: "How do you know we are okay again?", habit: "End conflict with appreciation.", principle: "Quick repair restores strength." },
                    growth: { range: [4, 6], status: "MILD GAP", pattern: "One partner resets faster than the other.", risk: "One may feel rushed; the other may feel ignored.", growth: "Agree on a 24-hour reconnection rule.", prompt: "How much time do you need to calm down?", habit: "Send reassurance during cooldown.", principle: "Patience closes emotional gaps." },
                    watch: { range: [7, 8], status: "WATCH ZONE", pattern: "Repair is inconsistent.", risk: "Unresolved tension quietly builds.", growth: "Two weekly reset conversations.", prompt: "Is anything still unresolved?", habit: "Physical reconnection after apology.", principle: "Silence hardens wounds." },
                    risk: { range: [9, 10], status: "SEVERE GAP", pattern: "Conflict ends without real resolution.", risk: "Emotional distance increases.", growth: "Structured mediation or coaching.", prompt: "Why do we avoid finishing conflict?", habit: "Never sleep without acknowledgment.", principle: "Restoration prevents distance." }
                }
            },
            3: {
                title: "Section 3: Money Alignment Index",
                desc: "How aligned you are about spending, saving, and financial control.",
                brackets: {
                    stable: { range: [0, 3], status: "ALIGNED", pattern: "You have similar financial values.", risk: "Alignment must be maintained during life changes.", growth: "Quarterly financial planning talk.", prompt: "What makes you feel financially secure?", habit: "Review major expenses together.", principle: "Shared stewardship builds trust." },
                    growth: { range: [4, 6], status: "GROWTH ZONE", pattern: "Some financial differences exist.", risk: "Unspoken assumptions lead to friction.", growth: "Set a shared spending limit rule.", prompt: "What financial decision worries you most?", habit: "Full transparency on purchases.", principle: "Transparency protects unity." },
                    watch: { range: [7, 8], status: "WATCH ZONE", pattern: "Clear differences in control or risk.", risk: "Money becomes linked to power.", growth: "Write joint financial principles.", prompt: "Where do you feel financially unheard?", habit: "No major decisions alone.", principle: "Integrity stabilizes partnership." },
                    risk: { range: [9, 10], status: "HIGH RISK", pattern: "Frequent money conflict or secrecy.", risk: "Financial distrust weakens the foundation.", growth: "Full financial disclosure exercise.", prompt: "What are we hiding financially?", habit: "Weekly 10-minute budget check-in.", principle: "Honesty rebuilds strength." }
                }
            },
            4: {
                title: "Section 4: Leadership Balance Index",
                desc: "How decisions are made and how power is shared.",
                brackets: {
                    stable: { range: [0, 3], status: "BALANCED", pattern: "Power is shared naturally and roles are respected.", risk: "Stagnation if neither partner takes a needed lead.", growth: "Rotate primary decision domains annually.", prompt: "Where do you feel most 'in your flow' as a lead?", habit: "Verbally invite partner's veto on major shifts.", principle: "Shared leadership doubles wisdom." },
                    growth: { range: [4, 6], status: "TRANSITIONAL", pattern: "One partner carries more weight than agreed.", risk: "Passive resentment builds for the over-burdened one.", growth: "Define clear leadership 'buckets' for each person.", prompt: "What decision do you find most exhausting?", habit: "Ask 'Do you need me to lead or follow here?'", principle: "Clarity reduces friction." },
                    watch: { range: [7, 8], status: "TENSION ZONE", pattern: "Power is contested or inconsistently applied.", risk: "Decision-making becomes a battle for autonomy.", growth: "Implement a 'Consensus or Delay' policy.", prompt: "Where do you feel controlled rather than led?", habit: "Stop the decision if tension rises.", principle: "Unity precedes action." },
                    risk: { range: [9, 10], status: "POWER STRUGGLE", pattern: "Dominance or dependency creates structural gaps.", risk: "One partner feels invisible; the other feels lonely.", growth: "Formalize a relational 'constitution' for authority.", prompt: "Are we teammates or opponents today?", habit: "Surrender one small daily lead to your partner.", principle: "Surrender preserves connection." }
                }
            },
            5: {
                title: "Section 5: Emotional Security Index",
                desc: "How safe and secure each partner feels emotionally.",
                brackets: {
                    stable: { range: [0, 3], status: "SECURE", pattern: "High trust and consistent emotional accessibility.", risk: "Complacency can mask internal shifts.", growth: "Daily 'emotional inventory' check-ins.", prompt: "How full is your emotional tank today?", habit: "Respond with 'I hear you' before solving.", principle: "Consistency builds a fortress." },
                    growth: { range: [4, 6], status: "UNCERTAIN", pattern: "Safety feels situational rather than architectural.", risk: "Attachment triggers can cause unexpected retreats.", growth: "Share your 'top 3 emotional safety needs'.", prompt: "What makes you feel most 'seen' by me?", habit: "Consistency in small gestures of care.", principle: "Trust is built in small moments." },
                    watch: { range: [7, 8], status: "FRAGILE", pattern: "Emotional distance is used as a defensive tool.", risk: "Isolation blocks repair and increases stress.", growth: "Commit to a 'no-withdrawal' rule for 24h post-fight.", prompt: "When do you feel safest pulling away?", habit: "Proactive physical touch during stress.", principle: "Vulnerability is the only way in." },
                    risk: { range: [9, 10], status: "CRITICAL GAP", pattern: "Chronic detachment or betrayal of safety.", risk: "Relationship core feels like a 'danger zone'.", growth: "Intensive focus on 'primal' attachment repair.", prompt: "Do I still feel like a safe place for you?", habit: "Immediate acknowledgment of partner's pain.", principle: "Safety is the engine’s oxygen." }
                }
            },
            6: {
                title: "Section 6: Pressure Test Index",
                desc: "How strong the relationship remains under stress.",
                brackets: {
                    stable: { range: [0, 3], status: "RESILIENT", pattern: "Stress unites you rather than divides you.", risk: "External shocks can still reveal hidden hairline cracks.", growth: "Prepare a 'crisis plan' for financial/health shocks.", prompt: "What is our biggest shared victory over stress?", habit: "Pivot to 'us-vs-the-problem' mindset immediately.", principle: "Pressure tempers true steel." },
                    growth: { range: [4, 6], status: "STRAINED", pattern: "External pressure leaks into the internal dynamic.", risk: "Chronic stress begins to erode the 'Friendship Base'.", growth: "Separate life-admin from relationship-connection.", prompt: "Which stressor is bleeding into our intimacy?", habit: "Schedule 'stress-free' zones/times.", principle: "Endurance requires pauses." },
                    watch: { range: [7, 8], status: "VULNERABLE", pattern: "The relationship starts to feel like a burden.", risk: "One or both begin to search for 'exits' from stress.", growth: "Identify and eliminate 'triangulation' with family.", prompt: "Is our relationship a source of rest or stress?", habit: "Active prayer/meditation together on stressors.", principle: "Focus on the anchor, not the storm." },
                    risk: { range: [9, 10], status: "COLLAPSE RISK", pattern: "Stress has paralyzed the relational machinery.", risk: "Structural failure is imminent without immediate intervention.", growth: "Radical simplification of life to save the core.", prompt: "What can we stop doing to survive?", habit: "Zero blame for external events.", principle: "Survival requires total unity." }
                }
            }
        };

        function generateTextProgressBar(score) {
            const filled = Math.min(10, Math.max(0, Math.round(score)));
            const empty = 10 - filled;
            return "[" + "█".repeat(filled) + "░".repeat(empty) + "] " + filled + "/10";
        }

        function getBracket(d, score) {
            const content = SCAN_CONTENT[d];
            if (!content) return null;
            if (score <= 3) return content.brackets.stable;
            if (score <= 6) return content.brackets.growth;
            if (score <= 8) return content.brackets.watch;
            return content.brackets.risk;
        }

        function calculateScores(answersArr) {
            const target = (answersArr || state.answers).map(a => SCORING_MAP[a] || 3);
            const res = {};

            const partnerData = (state.isPartner2 || state.p1Answers) ? (state.p1Answers || state.answers).map(a => SCORING_MAP[a] || 3) : null;
            const userData = target;

            for (let d = 1; d <= 6; d++) {
                const domainQuestions = QUESTIONS.filter(q => q.domain === d);
                const domainSize = domainQuestions.length;
                const axisAnswers = [];

                domainQuestions.forEach(q => {
                    const idx = QUESTIONS.findIndex(item => item.id === q.id);
                    if (idx !== -1) {
                        axisAnswers.push({
                            user: userData[idx],
                            partner: partnerData ? partnerData[idx] : userData[idx]
                        });
                    }
                });

                let axisScore = 0;
                if (partnerData) {
                    const rawDiff = axisAnswers.reduce((sum, item) => sum + Math.abs(item.user - item.partner), 0);
                    // Max diff per question is 4 (1 vs 5). 
                    // Normalizing to 10 scale: (rawDiff / (size * 4)) * 10
                    axisScore = (rawDiff / (domainSize * 4)) * 10;
                } else {
                    // For single user, we can't show "friction" without a partner.
                    // We'll show a baseline of 0 (no friction) or just skip details.
                    axisScore = 0;
                }

                const bracket = getBracket(d, axisScore);

                res[d] = {
                    score: axisScore,
                    status: bracket ? bracket.status : "UNKNOWN",
                    data: bracket
                };
            }
            return res;
        }


        function renderAlignmentForecast() {
            const scores = calculateScores();
            const p1Name = state.isPartner2 ? state.p1Name : state.name;
            const p2Name = state.isPartner2 ? state.name : "Partner 2";

            const isLocked = !state.isPartner2;
            const blurClass = isLocked ? "blur-content" : "";

            // Fix: Add no-scroll to body if locked to prevent long scrolling background
            if (isLocked) document.body.classList.add('no-scroll');
            else document.body.classList.remove('no-scroll');

            return `
                <div class="${isLocked ? 'h-[400px] overflow-hidden' : ''} space-y-12 pt-12 border-t border-slate-800 relative">
                    ${isLocked ? `
                        <div class="overlay-container">
                            <div class="bg-violet-600 p-8 rounded-3xl shadow-2xl space-y-6 max-w-sm border border-violet-400/30">
                                <div class="space-y-2">
                                    <h4 class="text-xl font-bold text-white uppercase tracking-tight">Unlock Combined Forecast</h4>
                                    <p class="text-slate-200 text-sm leading-relaxed">Your behavioral baseline is ready. To reveal your interaction dynamic and the full Stability Scan, sync with your partner.</p>
                                </div>
                                <div class="space-y-4 pt-4">
                                    <div class="space-y-2">
                                        <p class="text-[10px] font-black uppercase tracking-widest text-violet-200">Request Final Report via Email</p>
                                        <input type="email" id="email-capture-overlay" placeholder="Enter your email" class="w-full bg-violet-700/50 border border-violet-400/30 rounded-xl px-4 py-3 text-center text-white placeholder-violet-200 outline-none focus:ring-2 focus:ring-white transition-all text-sm font-medium">
                                    </div>
                                    <button onclick="generatePartnerLink()" class="w-full py-4 bg-white text-violet-600 rounded-xl font-black uppercase tracking-widest text-xs hover:bg-slate-100 transition-all shadow-xl">Copy Secret Partner Link</button>
                                </div>
                            </div>
                        </div>
                    ` : ''}

                    <div class="text-center space-y-2">
                        <h3 class="text-sm font-black uppercase tracking-[0.2em] text-violet-500">Stability Scan Results</h3>
                        <p class="text-3xl font-bold text-white">${p1Name} & ${p2Name}</p>
                    </div>

                    <div class="space-y-10 ${blurClass}">
                        ${Object.entries(scores).map(([id, result]) => {
                const content = SCAN_CONTENT[id];
                const d = result.data;
                if (!content || !d) return '';

                return `
                                <div class="space-y-6">
                                    <div class="bg-slate-800/40 p-8 rounded-3xl border border-slate-700/50 space-y-6">
                                        <div class="space-y-1">
                                            <h4 class="text-xs font-black uppercase tracking-widest text-slate-500">${content.title}</h4>
                                            <p class="text-sm text-slate-400 font-medium">${content.desc}</p>
                                        </div>

                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div class="space-y-1">
                                                <p class="text-[10px] font-bold text-slate-500 uppercase tracking-tighter">Score</p>
                                                <p class="text-xl font-black text-white">${Math.round(result.score)}/10</p>
                                            </div>
                                            <div class="space-y-1">
                                                <p class="text-[10px] font-bold text-slate-500 uppercase tracking-tighter">Status</p>
                                                <p class="text-xl font-black ${result.score >= 7 ? 'text-red-500' : (result.score >= 4 ? 'text-yellow-500' : 'text-green-500')} uppercase tracking-tighter">${result.status}</p>
                                            </div>
                                        </div>

                                        <div class="space-y-2">
                                            <p class="text-[10px] font-bold text-slate-500 uppercase tracking-tighter">Progress</p>
                                            <p class="font-mono text-sm text-violet-400 font-bold">${generateTextProgressBar(result.score)}</p>
                                        </div>

                                        <div class="pt-6 border-t border-slate-700/50 space-y-6">
                                            <div class="grid grid-cols-1 gap-6">
                                                <div class="space-y-2">
                                                    <p class="text-[10px] font-black uppercase tracking-widest text-violet-400">Your Pattern</p>
                                                    <p class="text-sm text-slate-200 leading-relaxed">${d.pattern}</p>
                                                </div>
                                                <div class="space-y-2">
                                                    <p class="text-[10px] font-black uppercase tracking-widest text-red-400">Risk Insight</p>
                                                    <p class="text-sm text-slate-400 italic font-medium leading-relaxed">"${d.risk}"</p>
                                                </div>
                                            </div>

                                            <div class="bg-slate-900/50 p-6 rounded-2xl border border-slate-700/30 space-y-4">
                                                <p class="text-[10px] font-black uppercase tracking-widest text-blue-400">Growth Levers</p>
                                                <div class="space-y-3">
                                                    <p class="text-sm text-slate-200"><span class="font-bold text-slate-400 uppercase text-[10px] mr-2">Measurable:</span> ${d.growth}</p>
                                                    <p class="text-sm text-slate-200"><span class="font-bold text-slate-400 uppercase text-[10px] mr-2">Prompt:</span> ${d.prompt}</p>
                                                    <p class="text-sm text-slate-200"><span class="font-bold text-slate-400 uppercase text-[10px] mr-2">Habit:</span> ${d.habit}</p>
                                                </div>
                                            </div>

                                            <div class="flex items-center space-x-3 text-slate-500 italic">
                                                <span class="text-[10px] font-black uppercase tracking-widest">Principled Guidance:</span>
                                                <span class="text-sm font-medium">"${d.principle}"</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;
            }).join('')}
                    </div>
                </div>
            `;
        }

        function renderSingleResults() {
            document.body.classList.remove('no-scroll');
            const track = state.gender === 'male' ? MALE_TRACK : FEMALE_TRACK;
            const pillars = state.gender === 'male' ? ["M1", "M2", "M3", "M4", "M5"] : ["F1", "F2", "F3", "F4", "F5"];

            const pillarScores = {};
            pillars.forEach(p => {
                const pillarAns = state.singleAnswers.filter(a => a.pillar === p);
                const sum = pillarAns.reduce((s, a) => s + a.score, 0);
                pillarScores[p] = {
                    sum: sum,
                    percentage: Math.round((sum / 30) * 100)
                };
            });

            const totalScore = Object.values(pillarScores).reduce((s, p) => s + p.sum, 0);
            const totalPercentage = Math.round((totalScore / 150) * 100);

            // Determine Archetype (Find lowest pillar)
            let lowestPillar = pillars[0];
            pillars.forEach(p => {
                if (pillarScores[p].percentage < pillarScores[lowestPillar].percentage) {
                    lowestPillar = p;
                }
            });

            // Trigger mapping for special conditions
            let archetypeKey = lowestPillar;
            if (pillarScores[lowestPillar].percentage > 60) {
                archetypeKey = "STABLE";
            }

            const arcData = (state.gender === 'male' ? MALE_ARCHETYPES : FEMALE_ARCHETYPES)[archetypeKey];

            const getBand = (p) => {
                if (p <= 40) return { label: "High Self-Sabotage", color: "text-red-500" };
                if (p <= 60) return { label: "Inconsistent Patterns", color: "text-orange-500" };
                if (p <= 75) return { label: "Stable but Developing", color: "text-yellow-500" };
                if (p <= 90) return { label: "Strong Foundation", color: "text-emerald-500" };
                return { label: "Mature & Intentional", color: "text-blue-500" };
            };

            const band = getBand(totalPercentage);

            return `
                <div class="fade-in space-y-10">
                    <div class="bg-emerald-600/10 border border-emerald-600/20 p-8 rounded-3xl text-center space-y-4">
                        <span class="text-xs font-black uppercase tracking-widest text-emerald-500">Who you are in dating</span>
                        <h3 class="text-4xl font-black text-white">${arcData.name}</h3>
                        <div class="flex items-center justify-center space-x-4">
                            <span class="text-xs font-bold text-slate-400 uppercase tracking-widest">${state.gender} track</span>
                            <span class="text-slate-700">|</span>
                            <span class="text-sm font-bold ${band.color}">${band.label} (${totalPercentage}%)</span>
                        </div>
                    </div>

                    <div class="bg-slate-800/40 p-8 rounded-3xl border border-slate-700/50 space-y-6">
                        <div class="space-y-3">
                            <h4 class="text-xs font-black uppercase tracking-widest text-emerald-400">What's going on</h4>
                            <p class="text-lg text-slate-200 leading-relaxed font-medium">${arcData.diagnosis}</p>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 pt-4">
                            <div class="space-y-4">
                                <h5 class="text-[10px] font-black uppercase tracking-widest text-slate-500">Things you do</h5>
                                <ul class="space-y-2">
                                    ${arcData.pattern.map(p => `
                                        <li class="text-sm text-slate-300 flex items-start">
                                            <span class="text-emerald-500 mr-2 mt-1">
                                                <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/></svg>
                                            </span>
                                            ${p}
                                        </li>`).join('')}
                                </ul>
                            </div>
                            <div class="space-y-6">
                                <div class="space-y-1">
                                    <h5 class="text-[10px] font-black uppercase tracking-widest text-violet-400">The vibe you give off</h5>
                                    <p class="text-sm text-slate-200 italic">"${arcData.signal}"</p>
                                </div>
                                <div class="space-y-1">
                                    <h5 class="text-[10px] font-black uppercase tracking-widest text-red-400">Where things usually go wrong</h5>
                                    <p class="text-sm text-slate-400 leading-relaxed font-medium">${arcData.failure}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-slate-800/40 p-6 rounded-3xl border border-slate-700/50 space-y-3">
                            <h4 class="text-[10px] font-black uppercase tracking-widest text-blue-400">How ready you are for something serious</h4>
                            <p class="text-lg text-white font-black">${arcData.readiness}</p>
                        </div>
                         <div class="bg-red-900/10 p-6 rounded-3xl border border-red-900/20 space-y-3">
                            <h4 class="text-[10px] font-black uppercase tracking-widest text-red-500">Heads up</h4>
                             <p class="text-sm text-slate-300 italic font-medium">"${totalPercentage < 50 ? 'High Risk of Repeating Past Relationship Cycles.' : (pillarScores[lowestPillar].percentage < 45 ? 'Critical pillar weakness detected below baseline.' : 'You\'re doing okay, but there\'s room to level up.')}"</p>
                        </div>
                    </div>

                    <div class="bg-slate-900/50 p-8 rounded-3xl border border-slate-700/30 space-y-8">
                        <h4 class="text-xs font-black uppercase tracking-widest text-slate-500 text-center">Your dating breakdown</h4>
                        <div class="grid grid-cols-1 gap-6">
                            ${Object.entries(pillarScores).map(([p, data]) => {
                const band = data.percentage <= 40 ? 'needs work' : (data.percentage <= 60 ? 'growing' : (data.percentage <= 75 ? 'solid' : (data.percentage <= 90 ? 'strong' : 'boss level')));
                const color = data.percentage <= 60 ? 'bg-red-500' : (data.percentage <= 75 ? 'bg-yellow-500' : 'bg-emerald-500');
                const pillarNames = state.gender === 'male' ? {
                    M1: "Identity & Vision",
                    M2: "Attraction & Confidence",
                    M3: "Emotional Control",
                    M4: "Leading & Boundaries",
                    M5: "Stability & Character"
                } : {
                    F1: "Self-Worth",
                    F2: "Warmth & Openness",
                    F3: "Emotional Balance",
                    F4: "Filtering & Wisdom",
                    F5: "Long-term Intentions"
                };
                return `
                                    <div class="space-y-2">
                                        <div class="flex justify-between items-end">
                                            <div class="flex flex-col">
                                                <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest">${pillarNames[p]}</span>
                                                <span class="text-[10px] font-bold text-slate-600">${band}</span>
                                            </div>
                                            <span class="text-xs font-black text-white">${data.percentage}%</span>
                                        </div>
                                        <div class="w-full h-1.5 bg-slate-800 rounded-full overflow-hidden">
                                            <div class="h-full ${color} transition-all duration-1000" style="width: ${data.percentage}%"></div>
                                        </div>
                                    </div>
                                `;
            }).join('')}
                        </div>
                    </div>

                    <div class="bg-emerald-600/5 p-8 rounded-3xl border border-emerald-600/10 space-y-10">
                        <div class="space-y-6">
                            <h4 class="text-xs font-black uppercase tracking-widest text-emerald-500">Your next 30 days</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-6">
                                ${arcData.action.map((a, i) => `
                                    <div class="text-sm text-slate-200 flex items-start">
                                        <span class="w-6 h-6 rounded-full bg-emerald-600/20 text-emerald-500 flex items-center justify-center text-[10px] font-black mr-3 flex-shrink-0">${i + 1}</span>
                                        <span class="pt-0.5">${a}</span>
                                    </div>`).join('')}
                            </div>
                        </div>
                        <div class="pt-10 border-t border-emerald-600/10 space-y-4">
                            <h4 class="text-xs font-black uppercase tracking-widest text-blue-400">Long-term growth</h4>
                            <div class="p-6 rounded-2xl bg-slate-900/50 border border-slate-800">
                                <p class="text-md text-slate-200 leading-relaxed font-medium">${arcData.growthPath}</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-violet-600/10 border border-violet-600/20 p-8 rounded-3xl text-center space-y-6">
                        <div class="space-y-2">
                            <h4 class="text-xs font-black uppercase tracking-widest text-violet-500">Relational Simulator</h4>
                            <p class="text-slate-300 text-sm">Test your reactions in real-world scenarios based on your weakest pillar: <span class="text-white font-bold">${state.gender === 'male' ? { M1: "Direction", M2: "Assertiveness", M3: "Emotional Stability", M4: "Leadership", M5: "Vetting" }[lowestPillar] : { F1: "Self-Worth", F2: "Receptivity", F3: "Emotional Regulation", F4: "Vetting", F5: "Long-Term" }[lowestPillar]}</span></p>
                        </div>
                        <button onclick="startSimulator('${lowestPillar}')" class="w-full py-5 bg-violet-600 hover:bg-violet-500 text-white rounded-2xl font-black uppercase tracking-widest text-xs transition-all shadow-xl shadow-violet-900/40">Try Training Simulation</button>
                    </div>

                    <div class="text-center px-8 pt-4">
                        <p class="text-slate-500 text-xs font-bold uppercase tracking-widest leading-relaxed">
                            Wisdom Layer: Patience over rushing • Character over chemistry • Mutual alignment
                        </p>
                    </div>
                </div>
            `;
        }

        function generatePartnerLink() {
            const payload = btoa(JSON.stringify({ name: state.name, answers: state.answers }));
            const url = new URL(window.location.href);
            url.searchParams.set('p1', payload);
            navigator.clipboard.writeText(url.toString());
            alert("Secret link copied! Send this to your partner.");
        }

        function checkParams() {
            const params = new URLSearchParams(window.location.search);
            if (params.get('p1')) {
                try {
                    const data = JSON.parse(atob(params.get('p1')));
                    state.p1Name = data.name || "Partner 1";
                    state.p1Answers = data.answers || [];
                    state.isPartner2 = true;
                } catch (e) { }
            }
        }

        async function syncToWebhook(isManual = false) {
            const overlayEmail = document.getElementById('email-capture-overlay')?.value;
            const mainEmail = document.getElementById('email-capture')?.value;
            const email = overlayEmail || mainEmail || "";

            const btn = document.getElementById('send-report-btn');
            const syncText = document.getElementById('sync-text');

            const payload = {
                timestamp: new Date().toISOString(),
                mode: state.mode,
                name: state.name,
                gender: state.gender,
                partner_name: state.isPartner2 ? state.p1Name : null,
                status: state.relationshipStatus,
                user_type: state.isPartner2 ? "P2" : "P1",
                answers: state.mode === 'single' ? state.singleAnswers : state.answers,
                email: email
            };

            if (isManual) {
                btn.disabled = true;
                btn.textContent = "SENDING...";
                syncText.textContent = "COMMUNICATING WITH ENGINE...";
            }

            try {
                const response = await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (isManual) {
                    btn.textContent = "REPORT SENT";
                    btn.classList.add('text-green-400');
                    syncText.textContent = "RELATIONAL DATA ENCRYPTED & SYNCED";
                }
            } catch (e) {
                if (isManual) {
                    btn.disabled = false;
                    btn.textContent = "SYNC FAILED - RETRY";
                    syncText.textContent = "SYNC ERROR - CHECK CONNECTION";
                }
            }
        }

        async function downloadPDF() {
            const element = document.getElementById('view-content');
            const opt = {
                margin: 0.5,
                filename: `Relation_Report_${state.name || 'User'}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true, backgroundColor: '#0f172a' },
                jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
            };

            // Add a temporary class to ensure dark background is captured correctly
            element.classList.add('pdf-capture');

            try {
                await html2pdf().set(opt).from(element).save();
            } catch (error) {
                console.error('PDF generation dimmed:', error);
                alert('Could not generate PDF. Please try again.');
            } finally {
                element.classList.remove('pdf-capture');
            }
        }

        function getLabel(t) { return { A: "Dominant", B: "Avoidant", C: "Secure", D: "Passive" }[t] || "Unknown"; }

        checkParams();
        render();
    </script>
</body>

</html>